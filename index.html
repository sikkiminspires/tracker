<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sikkim INSPIRES Programme Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f9fafb;
            line-height: 1.5;
            color: #374151;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        .header {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .header h1 {
            font-size: 2rem;
            font-weight: bold;
            color: #111827;
        }
        
        .header p {
            color: #6b7280;
            margin-top: 0.25rem;
        }
        
        .btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background-color 0.2s;
        }
        
        .btn:hover {
            background: #1d4ed8;
        }
        
        .btn-secondary {
            background: #6b7280;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        .btn-danger {
            background: #dc2626;
        }
        
        .btn-danger:hover {
            background: #b91c1c;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .stat-card {
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .stat-total { background: #dbeafe; border-color: #bfdbfe; color: #1e40af; }
        .stat-overdue { background: #fef2f2; border-color: #fecaca; color: #b91c1c; }
        .stat-urgent { background: #fff7ed; border-color: #fed7aa; color: #c2410c; }
        .stat-completed { background: #f0fdf4; border-color: #bbf7d0; color: #16a34a; }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .filters {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 0.5rem 0.5rem 0.5rem 2.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }
        
        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            width: 1rem;
            height: 1rem;
        }
        
        select, input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }
        
        .table-container {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th {
            background: #f9fafb;
            padding: 0.75rem 1rem;
            text-align: left;
            font-weight: 500;
            font-size: 0.875rem;
            color: #111827;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .table td {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.875rem;
            vertical-align: top;
        }
        
        .table tr:hover {
            background: #f9fafb;
        }
        
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.625rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            border: 1px solid;
        }
        
        .badge-dept {
            background: #dbeafe;
            color: #1e40af;
            border-color: #bfdbfe;
        }
        
        .badge-overdue {
            background: #fef2f2;
            color: #b91c1c;
            border-color: #fecaca;
        }
        
        .badge-urgent {
            background: #fff7ed;
            color: #c2410c;
            border-color: #fed7aa;
        }
        
        .badge-high {
            background: #fefce8;
            color: #a16207;
            border-color: #fde047;
        }
        
        .badge-medium {
            background: #dbeafe;
            color: #1e40af;
            border-color: #bfdbfe;
        }
        
        .badge-low {
            background: #f3f4f6;
            color: #374151;
            border-color: #d1d5db;
        }
        
        .actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            padding: 1rem;
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            width: 100%;
            max-width: 42rem;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .form-group label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
        }
        
        textarea {
            resize: vertical;
            min-height: 4rem;
        }
        
        .btn-group {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .btn-group .btn {
            flex: 1;
        }
        
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }
        
        .text-xs {
            font-size: 0.75rem;
        }
        
        .text-red {
            color: #dc2626;
        }
        
        .text-orange {
            color: #ea580c;
        }
        
        .text-green {
            color: #16a34a;
        }
        
        .text-gray {
            color: #6b7280;
        }
        
        .text-blue {
            color: #2563eb;
        }
        
        .font-medium {
            font-weight: 500;
        }
        
        .mt-1 {
            margin-top: 0.25rem;
        }
        
        .hidden {
            display: none !important;
        }
        
        .user-info {
            background: #1f2937;
            color: white;
            padding: 0.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
        }
        
        .user-role {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .role-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .role-admin {
            background: #10b981;
            color: white;
        }
        
        .role-operator {
            background: #f59e0b;
            color: white;
        }
        
        .role-viewer {
            background: #6b7280;
            color: white;
        }
        
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        .login-card {
            background: white;
            border-radius: 0.5rem;
            padding: 2rem;
            width: 100%;
            max-width: 450px;
            text-align: center;
        }
        
        .login-form {
            text-align: left;
            margin-top: 1.5rem;
        }
        
        .form-field {
            margin-bottom: 1rem;
        }
        
        .form-field label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }
        
        .form-field input, .form-field select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }
        
        .form-field input:focus, .form-field select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .access-info {
            background: #f3f4f6;
            border-radius: 0.375rem;
            padding: 1rem;
            margin: 1rem 0;
            font-size: 0.875rem;
            text-align: left;
        }
        
        .access-info h4 {
            margin: 0 0 0.5rem 0;
            color: #374151;
        }
        
        .settings-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .settings-menu {
            position: absolute;
            right: 0;
            top: 100%;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 0.5rem 0;
            min-width: 180px;
            z-index: 1000;
            display: none;
        }
        
        .settings-menu.show {
            display: block;
        }
        
        .settings-menu button {
            width: 100%;
            text-align: left;
            padding: 0.5rem 1rem;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 0.875rem;
            color: #374151;
        }
        
        .settings-menu button:hover {
            background: #f9fafb;
        }
        
        .error-message {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: #fef2f2;
            border-radius: 0.25rem;
            display: none;
        }
        
        .success-message {
            color: #16a34a;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: #f0fdf4;
            border-radius: 0.25rem;
            display: none;
        }
        
        .password-strength {
            margin-top: 0.5rem;
            font-size: 0.75rem;
        }
        
        .strength-weak { color: #dc2626; }
        .strength-medium { color: #f59e0b; }
        .strength-strong { color: #16a34a; }
        
        .permission-warning {
            background: #fef3c7;
            color: #92400e;
            padding: 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            margin: 0.5rem 0;
            display: none;
        }
        
        .main-nav {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0;
        }
        
        .nav-tabs {
            display: flex;
            gap: 0;
            border-bottom: none;
        }
        
        .nav-tab {
            padding: 1rem 1.5rem;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .nav-tab:hover {
            color: #374151;
            background: #f9fafb;
        }
        
        .nav-tab.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
            background: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .meeting-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .meeting-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .meeting-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #111827;
        }
        
        .meeting-date {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .meeting-section {
            margin-bottom: 1rem;
        }
        
        .meeting-section h4 {
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .meeting-section p {
            font-size: 0.875rem;
            color: #6b7280;
            line-height: 1.5;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                align-items: stretch;
            }
            
            .table-container {
                overflow-x: auto;
            }
            
            .modal {
                padding: 0.5rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .user-info {
                flex-direction: column;
                gap: 0.5rem;
                align-items: stretch;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .nav-tab {
                padding: 0.75rem 1rem;
                font-size: 0.8rem;
            }
        }

        /* Add debugging and status styles */
        .debug-info {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            padding: 0.5rem;
            margin: 0.5rem 0;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            color: #0c4a6e;
        }

        .status-message {
            padding: 0.75rem;
            border-radius: 0.375rem;
            margin: 1rem 0;
            font-size: 0.875rem;
        }

        .status-success {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #166534;
        }

        .status-error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
        }
    </style>
</head>
<body>
    <!-- Login Overlay -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-card">
            <h2>Sikkim INSPIRES Access Control</h2>
            <p>Please enter your credentials to access the system</p>
            
            <div class="access-info">
                <h4>Access Information:</h4>
                <div>Please contact your system administrator for login credentials.</div>
            </div>
            
            <div class="login-form">
                <div class="form-field">
                    <label for="loginUsername">Username</label>
                    <input type="text" id="loginUsername" placeholder="Enter your username">
                </div>
                
                <div class="form-field">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter password">
                </div>
                
                <div class="error-message" id="loginError"></div>
                
                <button class="btn" onclick="login()" id="loginBtn" style="width: 100%; margin-top: 1rem;">
                    Login
                </button>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal" id="changePasswordModal">
        <div class="modal-content">
            <h2>Change Password</h2>
            <div class="form-field">
                <label for="currentPassword">Current Password</label>
                <input type="password" id="currentPassword" placeholder="Enter current password">
            </div>
            <div class="form-field">
                <label for="newPassword">New Password</label>
                <input type="password" id="newPassword" placeholder="Enter new password" oninput="checkPasswordStrength()">
                <div class="password-strength" id="passwordStrength"></div>
            </div>
            <div class="form-field">
                <label for="confirmPassword">Confirm New Password</label>
                <input type="password" id="confirmPassword" placeholder="Confirm new password">
            </div>
            <div class="error-message" id="passwordError"></div>
            <div class="success-message" id="passwordSuccess"></div>
            <div class="btn-group">
                <button class="btn" onclick="changePassword()">Change Password</button>
                <button class="btn btn-secondary" onclick="hideChangePasswordModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- User Info Bar -->
    <div class="user-info">
        <div class="user-role">
            <span>Current User:</span>
            <span class="role-badge" id="userRoleBadge">System Administrator</span>
            <span id="userName">Admin User</span>
        </div>
        <div class="settings-dropdown">
            <button class="btn btn-sm btn-secondary" onclick="toggleSettingsMenu()">
                ‚öôÔ∏è Settings ‚ñº
            </button>
            <div class="settings-menu" id="settingsMenu">
                <button onclick="showChangePasswordModal()">üîí Change Password</button>
                <button onclick="logout()">üö™ Logout</button>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="main-nav">
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('tasks')">üìã Tasks Management</button>
            <button class="nav-tab" onclick="switchTab('meetings')">üìÑ Meeting Minutes</button>
        </div>
    </div>

    <div class="container">
        <!-- Status Messages -->
        <div id="statusMessages"></div>

        <!-- Tasks Tab Content -->
        <div id="tasksTab" class="tab-content active">
            <!-- Header -->
            <div class="header">
                <div class="header-content">
                    <div>
                        <h1>Sikkim INSPIRES</h1>
                        <p>Programme Activity Tracker</p>
                    </div>
                    <div>
                        <div class="permission-warning" id="permissionWarning">
                            ‚ö†Ô∏è You don't have permission to perform this action
                        </div>
                        <button class="btn" onclick="showAddTaskModal()" id="addTaskBtn">
                            <span>‚ûï</span> Add New Task
                        </button>
                    </div>
                </div>
                
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card stat-total">
                        <div>
                            <div class="text-xs">Total Tasks</div>
                            <div class="stat-number" id="totalTasks">0</div>
                        </div>
                    </div>
                    <div class="stat-card stat-overdue">
                        <div>
                            <div class="text-xs">Overdue</div>
                            <div class="stat-number" id="overdueTasks">0</div>
                        </div>
                    </div>
                    <div class="stat-card stat-urgent">
                        <div>
                            <div class="text-xs">Urgent</div>
                            <div class="stat-number" id="urgentTasks">0</div>
                        </div>
                    </div>
                    <div class="stat-card stat-completed">
                        <div>
                            <div class="text-xs">Completed</div>
                            <div class="stat-number" id="completedTasks">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters">
                <div class="filters-grid">
                    <div class="search-box">
                        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <input type="text" class="search-input" placeholder="Search tasks..." id="searchInput" oninput="filterTasks()">
                    </div>
                    <select id="departmentFilter" onchange="filterTasks()">
                        <option value="all">All Departments</option>
                        <option value="C&ID">C&ID</option>
                        <option value="DET">DET</option>
                        <option value="DIT">DIT</option>
                        <option value="H&FWD">H&FWD</option>
                        <option value="RDD">RDD</option>
                        <option value="SDD">SDD</option>
                        <option value="T&CAD">T&CAD</option>
                        <option value="WCDD">WCDD</option>
                    </select>
                    <select id="priorityFilter" onchange="filterTasks()">
                        <option value="all">All Priorities</option>
                        <option value="overdue">Overdue</option>
                        <option value="urgent">Urgent</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                    <select id="sortBy" onchange="filterTasks()">
                        <option value="deliveryDate">Sort by Delivery Date</option>
                        <option value="department">Sort by Department</option>
                        <option value="id">Sort by ID</option>
                    </select>
                </div>
            </div>

            <!-- Tasks Table -->
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Department</th>
                            <th>Status & Description</th>
                            <th>Timeline</th>
                            <th>Responsibility</th>
                            <th>Progress Status</th>
                            <th>Priority</th>
                            <th>Pending With</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tasksTableBody">
                        <!-- Tasks will be populated here -->
                    </tbody>
                </table>
                <div id="emptyState" class="empty-state" style="display: none;">
                    No tasks found matching your criteria.
                </div>
            </div>
        </div>

        <!-- Meeting Minutes Tab Content -->
        <div id="meetingsTab" class="tab-content">
            <!-- Header -->
            <div class="header">
                <div class="header-content">
                    <div>
                        <h1>Meeting Minutes</h1>
                        <p>Programme Meeting Records & Minutes</p>
                    </div>
                    <div>
                        <button class="btn" onclick="showAddMeetingModal()" id="addMeetingBtn">
                            <span>‚ûï</span> Add New Meeting
                        </button>
                    </div>
                </div>
            </div>

            <!-- Meeting Filters -->
            <div class="filters">
                <div class="filters-grid">
                    <div class="search-box">
                        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <input type="text" class="search-input" placeholder="Search meetings..." id="meetingSearchInput" oninput="filterMeetings()">
                    </div>
                    <select id="meetingDateFilter" onchange="filterMeetings()">
                        <option value="all">All Dates</option>
                        <option value="thisWeek">This Week</option>
                        <option value="thisMonth">This Month</option>
                        <option value="lastMonth">Last Month</option>
                    </select>
                    <select id="meetingSortBy" onchange="filterMeetings()">
                        <option value="date">Sort by Date (Latest First)</option>
                        <option value="title">Sort by Title</option>
                    </select>
                </div>
            </div>

            <!-- Meeting Minutes Container -->
            <div id="meetingsContainer">
                <!-- Meeting cards will be populated here -->
            </div>

            <div id="meetingEmptyState" class="empty-state" style="display: none;">
                No meeting minutes found.
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <h2 id="modalTitle">Add New Task</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="taskDepartment">Department *</label>
                    <select id="taskDepartment" required>
                        <option value="">Select Department</option>
                        <option value="C&ID">C&ID</option>
                        <option value="DET">DET</option>
                        <option value="DIT">DIT</option>
                        <option value="H&FWD">H&FWD</option>
                        <option value="RDD">RDD</option>
                        <option value="SDD">SDD</option>
                        <option value="T&CAD">T&CAD</option>
                        <option value="WCDD">WCDD</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="taskFrom">From</label>
                    <input type="text" id="taskFrom">
                </div>
                <div class="form-group">
                    <label for="taskTo">To</label>
                    <input type="text" id="taskTo">
                </div>
                <div class="form-group">
                    <label for="taskStartDate">Start Date *</label>
                    <input type="date" id="taskStartDate" required>
                </div>
                <div class="form-group">
                    <label for="taskDeliveryDate">Delivery Date</label>
                    <input type="date" id="taskDeliveryDate">
                </div>
                <div class="form-group">
                    <label for="taskPriority">Priority</label>
                    <select id="taskPriority">
                        <option value="auto">Auto (Based on Delivery Date)</option>
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                        <option value="urgent">Urgent</option>
                        <option value="overdue">Overdue</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="taskPendingWith">Pending With</label>
                    <input type="text" id="taskPendingWith" placeholder="Who is this task pending with?">
                </div>
            </div>
            <div class="form-group">
                <label for="taskStatus">Status Description *</label>
                <textarea id="taskStatus" rows="3" required placeholder="Describe the current status of this task..."></textarea>
            </div>
            <div class="form-group">
                <label for="taskRemarks">Remarks</label>
                <input type="text" id="taskRemarks" placeholder="Additional remarks or notes...">
            </div>
            <div class="form-group">
                <label for="taskProgress">Progress Details</label>
                <textarea id="taskProgress" rows="2" placeholder="Detailed progress description..."></textarea>
            </div>
            <div class="form-group">
                <label for="taskProgressDate">Progress Date</label>
                <input type="date" id="taskProgressDate">
            </div>
            <div class="form-group">
                <label for="taskNextStep">Next Step</label>
                <input type="text" id="taskNextStep" placeholder="What is the next action required?">
            </div>
            <div class="btn-group">
                <button class="btn" onclick="saveTask()">Save Task</button>
                <button class="btn btn-secondary" onclick="hideModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Meeting Modal -->
    <div class="modal" id="meetingModal">
        <div class="modal-content">
            <h2 id="meetingModalTitle">Add New Meeting</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="meetingTitle">Meeting Title *</label>
                    <input type="text" id="meetingTitle" placeholder="Enter meeting title" required>
                </div>
                <div class="form-group">
                    <label for="meetingDate">Meeting Date *</label>
                    <input type="datetime-local" id="meetingDate" required>
                </div>
                <div class="form-group">
                    <label for="meetingDepartments">Departments Involved</label>
                    <input type="text" id="meetingDepartments" placeholder="e.g., C&ID, DIT, PMU">
                </div>
                <div class="form-group">
                    <label for="meetingChairperson">Chairperson</label>
                    <input type="text" id="meetingChairperson" placeholder="Meeting chairperson">
                </div>
            </div>
            <div class="form-group">
                <label for="meetingAttendees">Attendees *</label>
                <textarea id="meetingAttendees" rows="3" placeholder="List of attendees..." required></textarea>
            </div>
            <div class="form-group">
                <label for="meetingObjective">Meeting Objective *</label>
                <textarea id="meetingObjective" rows="2" placeholder="Purpose/objective of the meeting..." required></textarea>
            </div>
            <div class="form-group">
                <label for="meetingDiscussion">Key Discussion Points</label>
                <textarea id="meetingDiscussion" rows="4" placeholder="Summary of key discussion points..."></textarea>
            </div>
            <div class="form-group">
                <label for="meetingDecisions">Decisions Made</label>
                <textarea id="meetingDecisions" rows="3" placeholder="Key decisions and outcomes..."></textarea>
            </div>
            <div class="form-group">
                <label for="meetingActionItems">Action Items</label>
                <textarea id="meetingActionItems" rows="4" placeholder="Action items with responsible persons and deadlines..."></textarea>
            </div>
            <div class="form-group">
                <label for="meetingNextSteps">Next Steps</label>
                <textarea id="meetingNextSteps" rows="2" placeholder="Next meeting date, follow-up actions..."></textarea>
            </div>
            <div class="btn-group">
                <button class="btn" onclick="saveMeeting()">Save Meeting</button>
                <button class="btn btn-secondary" onclick="hideMeetingModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // User Database with Password Authentication
        let userDatabase = {
            admin: {
                password: 'admin123',
                role: 'admin',
                name: 'System Administrator',
                lastLogin: null
            },
            operator: {
                password: 'op123',
                role: 'operator', 
                name: 'Data Entry Operator',
                lastLogin: null
            },
            viewer: {
                password: 'view123',
                role: 'viewer',
                name: 'Viewer',
                lastLogin: null
            }
        };

        // User Access Control System
        let currentUser = {
            username: null,
            role: null,
            name: '',
            permissions: {}
        };

        const roleConfig = {
            admin: {
                name: 'System Administrator',
                badge: 'role-admin',
                permissions: {
                    view: true,
                    add: true,
                    edit: true,
                    delete: true,
                    changePassword: true
                }
            },
            operator: {
                name: 'Data Entry Operator',
                badge: 'role-operator',
                permissions: {
                    view: true,
                    add: true,
                    edit: false,
                    delete: false,
                    changePassword: true
                }
            },
            viewer: {
                name: 'Viewer',
                badge: 'role-viewer',
                permissions: {
                    view: true,
                    add: false,
                    edit: false,
                    delete: false,
                    changePassword: true
                }
            }
        };

        // Meeting Minutes Data
        let meetings = [
            {
                id: 1,
                title: "Project Review Meeting - August 2025",
                date: "2025-08-06T10:00",
                departments: "PMU, C&ID, DIT, RDD, SDD",
                chairperson: "Project Director",
                attendees: "Project Director, TSA representatives from all departments, World Bank team",
                objective: "Review progress of all components and address key issues",
                discussion: "Progress updates from all departments were presented. Key discussion around DLR achievements, timeline challenges, and coordination between departments.",
                decisions: "Timeline adjustments approved for IEIAP district plans. Digital readiness training plan to be expedited.",
                actionItems: "1. TSA-SDD to submit skill gap study RFP by August 20th\n2. DIT to follow up with IVA for DLR verification\n3. C&ID to expedite NPA data collection from banks",
                nextSteps: "Next review meeting scheduled for August 25th during World Bank visit"
            },
            {
                id: 2,
                title: "Technical Working Group - Digital Infrastructure",
                date: "2025-08-08T14:00",
                departments: "DIT, PMU",
                chairperson: "Chief Secretary IT",
                attendees: "DIT officials, PMU team, TSA-DIT",
                objective: "Discuss State Data Centre DPR and digital readiness training implementation",
                discussion: "Review of feasibility study report for State Data Centre. Discussion on training vendor selection and implementation timeline.",
                decisions: "DPR preparation to proceed with selected vendor. Training calendar to be finalized within one week.",
                actionItems: "1. DIT to clarify DPR proposal status\n2. Vendor to submit detailed training plan\n3. Letters to be sent to all departments for training nominations",
                nextSteps: "Follow-up meeting with vendor next week to finalize training schedule"
            }
        ];

        // Current active tab
        let activeTab = 'tasks';
        let currentEditMeetingId = null;

        // Initial data - sample tasks
        let tasks = [
            {
                id: 1,
                department: "C&ID",
                status: "Convergence discussion between EEPF and Innovation Hub completed and TSA has shared the Scope of Work for Lead Incubation Partner with PMU for review.",
                remarks: "With PMU",
                from: "PMU",
                to: "C&ID",
                startDate: "2025-08-06",
                deliveryDate: "2025-08-20",
                progressDetails: "Initial discussions completed",
                progressDate: "2025-08-06",
                priority: "auto",
                pendingWith: "PMU",
                nextStep: "Await PMU review"
            },
            {
                id: 2,
                department: "DIT",
                status: "Digital readiness training - Approval from HCM received and work order has been issued to the identified vendor.",
                remarks: "Training plan awaited, timelines to be fixed",
                from: "Vendor",
                to: "DIT",
                startDate: "2025-08-06",
                deliveryDate: "2025-08-25",
                progressDetails: "Work order issued to vendor",
                progressDate: "2025-08-07",
                priority: "auto",
                pendingWith: "Vendor",
                nextStep: "Await training plan from vendor"
            }
        ];

        let currentEditId = null;

        // Utility function to show status messages
        function showStatusMessage(message, type = 'success') {
            const container = document.getElementById('statusMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `status-message status-${type}`;
            messageDiv.textContent = message;
            
            container.appendChild(messageDiv);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 5000);
        }

        // Tab switching function
        function switchTab(tabName) {
            // Remove active class from all tabs and content
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab and content
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            activeTab = tabName;
            
            // Initialize content based on active tab
            if (tabName === 'tasks') {
                renderTasks();
                updateStats();
            } else if (tabName === 'meetings') {
                renderMeetings();
                updateMeetingInterface();
            }
        }

        // Meeting Functions
        function renderMeetings(meetingsToRender = meetings) {
            const container = document.getElementById('meetingsContainer');
            const emptyState = document.getElementById('meetingEmptyState');
            
            if (meetingsToRender.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            container.innerHTML = meetingsToRender.map(meeting => {
                const meetingDate = new Date(meeting.date);
                const formattedDate = meetingDate.toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                const formattedTime = meetingDate.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                // Generate action buttons based on permissions
                let actionButtons = '';
                if (hasPermission('edit')) {
                    actionButtons += `<button class="btn btn-sm" onclick="editMeeting(${meeting.id})">‚úèÔ∏è Edit</button>`;
                }
                if (hasPermission('delete')) {
                    actionButtons += `<button class="btn btn-danger btn-sm" onclick="deleteMeeting(${meeting.id})">üóëÔ∏è Delete</button>`;
                }

                return `
                    <div class="meeting-card">
                        <div class="meeting-header">
                            <div>
                                <div class="meeting-title">${meeting.title}</div>
                                <div class="meeting-date">${formattedDate} at ${formattedTime}</div>
                            </div>
                            <div class="actions">
                                ${actionButtons}
                            </div>
                        </div>
                        
                        <div class="meeting-section">
                            <h4>Departments: <span class="badge badge-dept">${meeting.departments}</span></h4>
                            <h4>Chairperson: ${meeting.chairperson}</h4>
                        </div>
                        
                        <div class="meeting-section">
                            <h4>Attendees</h4>
                            <p>${meeting.attendees}</p>
                        </div>
                        
                        <div class="meeting-section">
                            <h4>Meeting Objective</h4>
                            <p>${meeting.objective}</p>
                        </div>
                        
                        <div class="meeting-section">
                            <h4>Key Discussion Points</h4>
                            <p>${meeting.discussion}</p>
                        </div>
                        
                        <div class="meeting-section">
                            <h4>Decisions Made</h4>
                            <p>${meeting.decisions}</p>
                        </div>
                        
                        <div class="meeting-section">
                            <h4>Action Items</h4>
                            <p style="white-space: pre-line;">${meeting.actionItems}</p>
                        </div>
                        
                        <div class="meeting-section">
                            <h4>Next Steps</h4>
                            <p>${meeting.nextSteps}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterMeetings() {
            const searchTerm = document.getElementById('meetingSearchInput').value.toLowerCase();
            const dateFilter = document.getElementById('meetingDateFilter').value;
            const sortBy = document.getElementById('meetingSortBy').value;
            
            let filtered = meetings.filter(meeting => {
                const matchesSearch = meeting.title.toLowerCase().includes(searchTerm) ||
                                   meeting.departments.toLowerCase().includes(searchTerm) ||
                                   meeting.discussion.toLowerCase().includes(searchTerm) ||
                                   meeting.decisions.toLowerCase().includes(searchTerm);
                
                let matchesDate = true;
                if (dateFilter !== 'all') {
                    const meetingDate = new Date(meeting.date);
                    const now = new Date();
                    
                    switch(dateFilter) {
                        case 'thisWeek':
                            const weekStart = new Date(now.setDate(now.getDate() - now.getDay()));
                            const weekEnd = new Date(now.setDate(weekStart.getDate() + 6));
                            matchesDate = meetingDate >= weekStart && meetingDate <= weekEnd;
                            break;
                        case 'thisMonth':
                            matchesDate = meetingDate.getMonth() === now.getMonth() && 
                                        meetingDate.getFullYear() === now.getFullYear();
                            break;
                        case 'lastMonth':
                            const lastMonth = new Date(now.getFullYear(), now.getMonth() - 1);
                            matchesDate = meetingDate.getMonth() === lastMonth.getMonth() && 
                                        meetingDate.getFullYear() === lastMonth.getFullYear();
                            break;
                    }
                }
                
                return matchesSearch && matchesDate;
            });

            // Sort meetings
            filtered.sort((a, b) => {
                if (sortBy === 'date') {
                    return new Date(b.date) - new Date(a.date); // Latest first
                }
                if (sortBy === 'title') {
                    return a.title.localeCompare(b.title);
                }
                return 0;
            });

            renderMeetings(filtered);
        }

        function showAddMeetingModal() {
            if (!checkPermission('add')) return;
            
            currentEditMeetingId = null;
            document.getElementById('meetingModalTitle').textContent = 'Add New Meeting';
            clearMeetingForm();
            
            // Set default date to now
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('meetingDate').value = now.toISOString().slice(0, 16);
            
            document.getElementById('meetingModal').classList.add('show');
        }

        function editMeeting(id) {
            if (!checkPermission('edit')) return;
            
            const meeting = meetings.find(m => m.id === id);
            if (!meeting) return;
            
            currentEditMeetingId = id;
            document.getElementById('meetingModalTitle').textContent = 'Edit Meeting';
            
            document.getElementById('meetingTitle').value = meeting.title;
            document.getElementById('meetingDate').value = meeting.date;
            document.getElementById('meetingDepartments').value = meeting.departments;
            document.getElementById('meetingChairperson').value = meeting.chairperson;
            document.getElementById('meetingAttendees').value = meeting.attendees;
            document.getElementById('meetingObjective').value = meeting.objective;
            document.getElementById('meetingDiscussion').value = meeting.discussion;
            document.getElementById('meetingDecisions').value = meeting.decisions;
            document.getElementById('meetingActionItems').value = meeting.actionItems;
            document.getElementById('meetingNextSteps').value = meeting.nextSteps;
            
            document.getElementById('meetingModal').classList.add('show');
        }

        function deleteMeeting(id) {
            if (!checkPermission('delete')) return;
            
            if (confirm('Are you sure you want to delete this meeting record?')) {
                meetings = meetings.filter(m => m.id !== id);
                filterMeetings();
                showStatusMessage('Meeting deleted successfully!');
            }
        }

        function saveMeeting() {
            const isEditing = currentEditMeetingId !== null;
            const requiredPermission = isEditing ? 'edit' : 'add';
            
            if (!checkPermission(requiredPermission)) return;
            
            const formData = {
                title: document.getElementById('meetingTitle').value.trim(),
                date: document.getElementById('meetingDate').value,
                departments: document.getElementById('meetingDepartments').value.trim(),
                chairperson: document.getElementById('meetingChairperson').value.trim(),
                attendees: document.getElementById('meetingAttendees').value.trim(),
                objective: document.getElementById('meetingObjective').value.trim(),
                discussion: document.getElementById('meetingDiscussion').value.trim(),
                decisions: document.getElementById('meetingDecisions').value.trim(),
                actionItems: document.getElementById('meetingActionItems').value.trim(),
                nextSteps: document.getElementById('meetingNextSteps').value.trim()
            };
            
            // Validation
            if (!formData.title || !formData.date || !formData.attendees || !formData.objective) {
                showStatusMessage('Please fill in all required fields (Title, Date, Attendees, Objective)', 'error');
                return;
            }
            
            try {
                if (currentEditMeetingId) {
                    // Edit existing meeting
                    const meetingIndex = meetings.findIndex(m => m.id === currentEditMeetingId);
                    if (meetingIndex === -1) {
                        showStatusMessage('Meeting not found for editing', 'error');
                        return;
                    }
                    meetings[meetingIndex] = { ...meetings[meetingIndex], ...formData };
                    showStatusMessage('Meeting updated successfully!');
                } else {
                    // Add new meeting
                    const newMeeting = {
                        ...formData,
                        id: Math.max(...meetings.map(m => m.id), 0) + 1
                    };
                    meetings.push(newMeeting);
                    showStatusMessage('Meeting added successfully!');
                }
                
                hideMeetingModal();
                filterMeetings();
                
            } catch (error) {
                console.error('Error saving meeting:', error);
                showStatusMessage('Error saving meeting. Please try again.', 'error');
            }
        }

        function hideMeetingModal() {
            document.getElementById('meetingModal').classList.remove('show');
            clearMeetingForm();
        }

        function clearMeetingForm() {
            document.getElementById('meetingTitle').value = '';
            document.getElementById('meetingDate').value = '';
            document.getElementById('meetingDepartments').value = '';
            document.getElementById('meetingChairperson').value = '';
            document.getElementById('meetingAttendees').value = '';
            document.getElementById('meetingObjective').value = '';
            document.getElementById('meetingDiscussion').value = '';
            document.getElementById('meetingDecisions').value = '';
            document.getElementById('meetingActionItems').value = '';
            document.getElementById('meetingNextSteps').value = '';
        }

        function updateMeetingInterface() {
            const addMeetingBtn = document.getElementById('addMeetingBtn');
            
            if (hasPermission('add')) {
                addMeetingBtn.classList.remove('hidden');
            } else {
                addMeetingBtn.classList.add('hidden');
            }
        }

        // Password utilities
        function validatePassword(password) {
            const minLength = 6;
            const hasUpper = /[A-Z]/.test(password);
            const hasLower = /[a-z]/.test(password);
            const hasNumber = /\d/.test(password);
            
            if (password.length < minLength) {
                return { valid: false, message: 'Password must be at least 6 characters long' };
            }
            
            let strength = 'weak';
            let score = 0;
            
            if (password.length >= 8) score++;
            if (hasUpper) score++;
            if (hasLower) score++;
            if (hasNumber) score++;
            
            if (score >= 3) strength = 'strong';
            else if (score >= 2) strength = 'medium';
            
            return { valid: true, strength, score };
        }

        function checkPasswordStrength() {
            const password = document.getElementById('newPassword').value;
            const strengthDiv = document.getElementById('passwordStrength');
            
            if (!password) {
                strengthDiv.innerHTML = '';
                return;
            }
            
            const validation = validatePassword(password);
            
            if (!validation.valid) {
                strengthDiv.innerHTML = `<span class="strength-weak">${validation.message}</span>`;
                return;
            }
            
            const strengthClass = `strength-${validation.strength}`;
            const strengthText = validation.strength.charAt(0).toUpperCase() + validation.strength.slice(1);
            
            strengthDiv.innerHTML = `<span class="${strengthClass}">Password strength: ${strengthText}</span>`;
        }

        // Authentication functions
        function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                showError('loginError', 'Please enter both username and password');
                return;
            }
            
            const user = userDatabase[username];
            if (!user || user.password !== password) {
                showError('loginError', 'Invalid username or password');
                return;
            }
            
            // Successful login
            currentUser.username = username;
            currentUser.role = user.role;
            currentUser.name = user.name;
            currentUser.permissions = roleConfig[user.role].permissions;
            
            // Update last login
            userDatabase[username].lastLogin = new Date().toISOString();
            
            // Update UI
            updateUserInterface();
            
            // Hide login overlay
            document.getElementById('loginOverlay').style.display = 'none';
            
            // Initialize the app
            initializeApp();
            
            showStatusMessage(`Welcome, ${user.name}! You are logged in as ${roleConfig[user.role].name}.`);
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = { username: null, role: null, name: '', permissions: {} };
                
                // Reset login form
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
                hideError('loginError');
                
                // Hide settings menu
                hideSettingsMenu();
                
                // Show login overlay
                document.getElementById('loginOverlay').style.display = 'flex';
            }
        }

        // Settings menu functions
        function toggleSettingsMenu() {
            const menu = document.getElementById('settingsMenu');
            menu.classList.toggle('show');
        }

        function hideSettingsMenu() {
            document.getElementById('settingsMenu').classList.remove('show');
        }

        // Change password functions
        function showChangePasswordModal() {
            hideSettingsMenu();
            document.getElementById('changePasswordModal').classList.add('show');
            // Clear form
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            document.getElementById('passwordStrength').innerHTML = '';
            hideError('passwordError');
            hideSuccess('passwordSuccess');
        }

        function hideChangePasswordModal() {
            document.getElementById('changePasswordModal').classList.remove('show');
        }

        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Validate current password
            if (userDatabase[currentUser.username].password !== currentPassword) {
                showError('passwordError', 'Current password is incorrect');
                return;
            }
            
            // Validate new password
            const validation = validatePassword(newPassword);
            if (!validation.valid) {
                showError('passwordError', validation.message);
                return;
            }
            
            // Check password confirmation
            if (newPassword !== confirmPassword) {
                showError('passwordError', 'New passwords do not match');
                return;
            }
            
            // Check if new password is different
            if (newPassword === currentPassword) {
                showError('passwordError', 'New password must be different from current password');
                return;
            }
            
            // Update password
            userDatabase[currentUser.username].password = newPassword;
            
            showSuccess('passwordSuccess', 'Password changed successfully!');
            
            // Clear form after 2 seconds and close modal
            setTimeout(() => {
                hideChangePasswordModal();
            }, 2000);
        }

        // Utility functions for messages
        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
        }

        function hideError(elementId) {
            const element = document.getElementById(elementId);
            element.style.display = 'none';
        }

        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
        }

        function hideSuccess(elementId) {
            const element = document.getElementById(elementId);
            element.style.display = 'none';
        }

        // Permission Management Functions
        function hasPermission(action) {
            return currentUser.permissions && currentUser.permissions[action] === true;
        }

        function checkPermission(action) {
            if (!hasPermission(action)) {
                showPermissionWarning();
                showStatusMessage(`You don't have permission to ${action} items. Please contact your administrator.`, 'error');
                return false;
            }
            return true;
        }

        function showPermissionWarning() {
            const warning = document.getElementById('permissionWarning');
            warning.style.display = 'block';
            setTimeout(() => {
                warning.style.display = 'none';
            }, 3000);
        }

        function updateUserInterface() {
            // Update user info display
            const roleBadge = document.getElementById('userRoleBadge');
            const userName = document.getElementById('userName');
            
            roleBadge.textContent = roleConfig[currentUser.role].name;
            roleBadge.className = `role-badge ${roleConfig[currentUser.role].badge}`;
            userName.textContent = userDatabase[currentUser.username].name;
            
            // Update button visibility based on permissions
            const addTaskBtn = document.getElementById('addTaskBtn');
            
            if (hasPermission('add')) {
                addTaskBtn.classList.remove('hidden');
            } else {
                addTaskBtn.classList.add('hidden');
            }
            
            // Update interface based on active tab
            if (activeTab === 'tasks') {
                filterTasks();
            } else if (activeTab === 'meetings') {
                updateMeetingInterface();
                filterMeetings();
            }
        }

        function initializeApp() {
            if (activeTab === 'tasks') {
                renderTasks();
                updateStats();
            } else if (activeTab === 'meetings') {
                renderMeetings();
                updateMeetingInterface();
            }
        }

        // Task management functions
        function getTaskPriority(task) {
            // If priority is manually set (not "auto"), use that
            if (task.priority && task.priority !== "auto") {
                return task.priority;
            }
            
            // Otherwise calculate based on delivery date
            if (!task.deliveryDate) return 'low';
            const today = new Date();
            const delivery = new Date(task.deliveryDate);
            const daysRemaining = Math.ceil((delivery - today) / (1000 * 60 * 60 * 24));
            
            if (daysRemaining < 0) return 'overdue';
            if (daysRemaining <= 3) return 'urgent';
            if (daysRemaining <= 7) return 'high';
            return 'medium';
        }

        function getDaysRemaining(deliveryDate) {
            if (!deliveryDate) return null;
            const today = new Date();
            const delivery = new Date(deliveryDate);
            return Math.ceil((delivery - today) / (1000 * 60 * 60 * 24));
        }

        function formatDate(dateStr) {
            if (!dateStr) return 'N/A';
            return new Date(dateStr).toLocaleDateString();
        }

        function renderTasks(tasksToRender = tasks) {
            const tbody = document.getElementById('tasksTableBody');
            const emptyState = document.getElementById('emptyState');
            
            if (tasksToRender.length === 0) {
                tbody.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            tbody.innerHTML = tasksToRender.map(task => {
                const priority = getTaskPriority(task);
                const daysRemaining = getDaysRemaining(task.deliveryDate);
                
                let timelineHtml = `<div class="text-xs text-gray">Start: ${formatDate(task.startDate)}</div>`;
                if (task.deliveryDate) {
                    timelineHtml += `<div class="text-xs">Due: ${formatDate(task.deliveryDate)}</div>`;
                }
                if (daysRemaining !== null) {
                    const timeClass = daysRemaining < 0 ? 'text-red' : daysRemaining <= 3 ? 'text-orange' : 'text-green';
                    const timeText = daysRemaining < 0 ? `${Math.abs(daysRemaining)} days overdue` : `${daysRemaining} days left`;
                    timelineHtml += `<div class="text-xs font-medium ${timeClass}">${timeText}</div>`;
                }
                
                let responsibilityHtml = '';
                if (task.from) responsibilityHtml += `<div class="text-xs"><span class="text-gray">From:</span> ${task.from}</div>`;
                if (task.to) responsibilityHtml += `<div class="text-xs"><span class="text-gray">To:</span> ${task.to}</div>`;
                
                let detailsHtml = `<div class="text-gray-900">${task.status}</div>`;
                if (task.remarks) detailsHtml += `<div class="text-xs text-gray mt-1"><strong>Remarks:</strong> ${task.remarks}</div>`;
                if (task.nextStep) detailsHtml += `<div class="text-xs text-green mt-1"><strong>Next Step:</strong> ${task.nextStep}</div>`;
                
                let progressHtml = '';
                if (task.progressDetails) {
                    progressHtml += `<div class="text-xs text-blue"><strong>Details:</strong> ${task.progressDetails}</div>`;
                }
                if (task.progressDate) {
                    progressHtml += `<div class="text-xs text-gray mt-1"><strong>Updated:</strong> ${formatDate(task.progressDate)}</div>`;
                }
                if (!progressHtml) {
                    progressHtml = '<div class="text-xs text-gray">No progress updates</div>';
                }
                
                const priorityDisplay = task.priority === 'auto' ? 
                    `${priority.charAt(0).toUpperCase() + priority.slice(1)} (Auto)` : 
                    priority.charAt(0).toUpperCase() + priority.slice(1);
                
                // Generate action buttons based on permissions
                let actionButtons = '';
                if (hasPermission('edit')) {
                    actionButtons += `<button class="btn btn-sm" onclick="editTask(${task.id})">‚úèÔ∏è</button>`;
                }
                if (hasPermission('delete')) {
                    actionButtons += `<button class="btn btn-danger btn-sm" onclick="deleteTask(${task.id})">üóëÔ∏è</button>`;
                }
                if (!actionButtons) {
                    actionButtons = '<span class="text-xs text-gray">No actions available</span>';
                }
                
                let pendingWithHtml = '';
                if (task.pendingWith) {
                    pendingWithHtml = `<div class="text-xs"><span class="badge badge-dept">${task.pendingWith}</span></div>`;
                } else {
                    pendingWithHtml = '<div class="text-xs text-gray">Not specified</div>';
                }
                
                return `
                    <tr>
                        <td>
                            <span class="badge badge-dept">${task.department}</span>
                        </td>
                        <td>${detailsHtml}</td>
                        <td>${timelineHtml}</td>
                        <td>${responsibilityHtml}</td>
                        <td>${progressHtml}</td>
                        <td>
                            <span class="badge badge-${priority}">
                                ${priorityDisplay}
                            </span>
                        </td>
                        <td>${pendingWithHtml}</td>
                        <td>
                            <div class="actions">
                                ${actionButtons}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function updateStats() {
            const stats = {
                total: tasks.length,
                overdue: tasks.filter(t => getTaskPriority(t) === 'overdue').length,
                urgent: tasks.filter(t => getTaskPriority(t) === 'urgent').length,
                completed: tasks.filter(t => t.status.toLowerCase().includes('completed')).length
            };
            
            document.getElementById('totalTasks').textContent = stats.total;
            document.getElementById('overdueTasks').textContent = stats.overdue;
            document.getElementById('urgentTasks').textContent = stats.urgent;
            document.getElementById('completedTasks').textContent = stats.completed;
        }

        function filterTasks() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const departmentFilter = document.getElementById('departmentFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;
            const sortBy = document.getElementById('sortBy').value;
            
            let filtered = tasks.filter(task => {
                const matchesSearch = task.status.toLowerCase().includes(searchTerm) ||
                                   task.department.toLowerCase().includes(searchTerm) ||
                                   (task.remarks && task.remarks.toLowerCase().includes(searchTerm)) ||
                                   (task.pendingWith && task.pendingWith.toLowerCase().includes(searchTerm));
                const matchesDepartment = departmentFilter === 'all' || task.department === departmentFilter;
                const matchesPriority = priorityFilter === 'all' || getTaskPriority(task) === priorityFilter;
                
                return matchesSearch && matchesDepartment && matchesPriority;
            });

            // Sort
            filtered.sort((a, b) => {
                if (sortBy === 'deliveryDate') {
                    if (!a.deliveryDate && !b.deliveryDate) return 0;
                    if (!a.deliveryDate) return 1;
                    if (!b.deliveryDate) return -1;
                    return new Date(a.deliveryDate) - new Date(b.deliveryDate);
                }
                if (sortBy === 'department') {
                    return a.department.localeCompare(b.department);
                }
                return a.id - b.id;
            });

            renderTasks(filtered);
        }

        function showAddTaskModal() {
            if (!checkPermission('add')) return;
            
            currentEditId = null;
            document.getElementById('modalTitle').textContent = 'Add New Task';
            clearForm();
            document.getElementById('taskStartDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('taskPriority').value = 'auto';
            document.getElementById('taskModal').classList.add('show');
        }

        function editTask(id) {
            if (!checkPermission('edit')) return;
            
            const task = tasks.find(t => t.id === id);
            if (!task) return;
            
            currentEditId = id;
            document.getElementById('modalTitle').textContent = 'Edit Task';
            
            document.getElementById('taskDepartment').value = task.department;
            document.getElementById('taskStatus').value = task.status;
            document.getElementById('taskRemarks').value = task.remarks || '';
            document.getElementById('taskFrom').value = task.from || '';
            document.getElementById('taskTo').value = task.to || '';
            document.getElementById('taskStartDate').value = task.startDate;
            document.getElementById('taskDeliveryDate').value = task.deliveryDate || '';
            document.getElementById('taskPriority').value = task.priority || 'auto';
            document.getElementById('taskProgress').value = task.progressDetails || '';
            document.getElementById('taskProgressDate').value = task.progressDate || '';
            document.getElementById('taskPendingWith').value = task.pendingWith || '';
            document.getElementById('taskNextStep').value = task.nextStep || '';
            
            document.getElementById('taskModal').classList.add('show');
        }

        function deleteTask(id) {
            if (!checkPermission('delete')) return;
            
            if (confirm('Are you sure you want to delete this task?')) {
                tasks = tasks.filter(t => t.id !== id);
                filterTasks();
                updateStats();
                showStatusMessage('Task deleted successfully!');
            }
        }

        function saveTask() {
            const isEditing = currentEditId !== null;
            const requiredPermission = isEditing ? 'edit' : 'add';
            
            if (!checkPermission(requiredPermission)) return;
            
            const formData = {
                department: document.getElementById('taskDepartment').value.trim(),
                status: document.getElementById('taskStatus').value.trim(),
                remarks: document.getElementById('taskRemarks').value.trim(),
                from: document.getElementById('taskFrom').value.trim(),
                to: document.getElementById('taskTo').value.trim(),
                startDate: document.getElementById('taskStartDate').value,
                deliveryDate: document.getElementById('taskDeliveryDate').value,
                priority: document.getElementById('taskPriority').value,
                progressDetails: document.getElementById('taskProgress').value.trim(),
                progressDate: document.getElementById('taskProgressDate').value,
                pendingWith: document.getElementById('taskPendingWith').value.trim(),
                nextStep: document.getElementById('taskNextStep').value.trim()
            };
            
            // Validation
            if (!formData.department || !formData.status || !formData.startDate) {
                showStatusMessage('Please fill in all required fields (Department, Status, Start Date)', 'error');
                return;
            }
            
            try {
                if (currentEditId) {
                    // Edit existing task
                    const taskIndex = tasks.findIndex(t => t.id === currentEditId);
                    if (taskIndex === -1) {
                        showStatusMessage('Task not found for editing', 'error');
                        return;
                    }
                    tasks[taskIndex] = { ...tasks[taskIndex], ...formData };
                    showStatusMessage('Task updated successfully!');
                } else {
                    // Add new task
                    const newTask = {
                        ...formData,
                        id: Math.max(...tasks.map(t => t.id), 0) + 1
                    };
                    tasks.push(newTask);
                    showStatusMessage('Task added successfully!');
                }
                
                hideModal();
                filterTasks();
                updateStats();
                
            } catch (error) {
                console.error('Error saving task:', error);
                showStatusMessage('Error saving task. Please try again.', 'error');
            }
        }

        function hideModal() {
            document.getElementById('taskModal').classList.remove('show');
            clearForm();
        }

        function clearForm() {
            document.getElementById('taskDepartment').value = '';
            document.getElementById('taskStatus').value = '';
            document.getElementById('taskRemarks').value = '';
            document.getElementById('taskFrom').value = '';
            document.getElementById('taskTo').value = '';
            document.getElementById('taskStartDate').value = '';
            document.getElementById('taskDeliveryDate').value = '';
            document.getElementById('taskPriority').value = 'auto';
            document.getElementById('taskProgress').value = '';
            document.getElementById('taskProgressDate').value = '';
            document.getElementById('taskPendingWith').value = '';
            document.getElementById('taskNextStep').value = '';
        }

        // Event Listeners
        
        // Close settings menu when clicking outside
        document.addEventListener('click', function(e) {
            const dropdown = document.querySelector('.settings-dropdown');
            if (!dropdown.contains(e.target)) {
                hideSettingsMenu();
            }
        });

        // Close modals when clicking outside
        document.getElementById('taskModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideModal();
            }
        });

        document.getElementById('changePasswordModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideChangePasswordModal();
            }
        });

        document.getElementById('meetingModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideMeetingModal();
            }
        });

        // Allow Enter key to login
        document.getElementById('loginPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Application initialized');
            // Start with login screen
            document.getElementById('loginOverlay').style.display = 'flex';
        });
    </script>
</body>
</html>
